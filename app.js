let tiktokApi = {
			"listsUser1" : [
				{
					"id":1,
					"avt" :"./src/image/avatar1.jpeg",
					"nickName":"pika-Chuuu",
					"realName":"Khánh Huyền",
					"follows":"7.49M",
					"likes":"87M",
					"trending" : {
						"status" : "cute qua đi nè :)))",
						"tags" : ["dendakhongduong","babycat","rap","cute"],
						"music": "Đen đá không đường (cover) - khánh khuyền ",
						"video": "./src/video/video1.mp4"
					}
				},
				{
					"id":2,
					"avt" :"./src/image/avatar2.jpeg",
					"nickName":"Ánh Linh",
					"realName":"Đỗ Thị Cẩm Linh",
					"follows":"99.4M",
					"likes":"154M",
					"trending" : {
						"status" : "nắm tay em nhé <3 :))))",
						"tags" : ["Dance","thanhhung","dungnguoidungthoidiem","tynhyeu"],
						"music": "Đúng người đúng thời điểm - Thanh Hưng",
						"video": "./src/video/video2.mp4"
					}
				},
				{
					"id":3,
					"avt" :"./src/image/avatar3.jpeg",
					"nickName":"cizimi-Cute",
					"realName":"Cizimi :*",
					"follows":"432M",
					"likes":"1111M",
					"trending" : {
						"status" : "Hello các bạn <3 ^^",
						"tags" : ["study","cameraBeauty","Hotgirl"],
						"music": "cute kute - abby",
						"video": "./src/video/video3.mp4"
					}
				},
			],
			"listsUser2" : [
				{
					"id":4,
					"avt" :"./src/image/avatar4.jpeg",
					"nickName":"chingching2k4",
					"realName":"ching ching",
					"follows":"39.4M",
					"likes":"54M",
					"trending" : {
						"status" : "Đỉnh cao phá trend là đây ^^",
						"tags" : ["hitdance","dj","hottiktok"],
						"music": "dance hit - dj junghup",
						"video": "./src/video/video7.mp4"
					}
				},
				{
					"id":5,
					"avt" :"./src/image/avatar5.jpeg",
					"nickName":"kiwikimquy",
					"realName":"Kim quy",
					"follows":"399.4M",
					"likes":"432M",
					"trending" : {
						"status" : "Ngủ đi các bạn ơi :*",
						"tags" : ["tâm sự"],
						"music": "nhạc nền - kiwikimquy",
						"video": "./src/video/video8.mp4"
					}
				},
				{
					"id":6,
					"avt" :"./src/image/avatar6.jpeg",
					"nickName":"Huyền Trang",
					"realName":"Trần Thị Huyền Trang",
					"follows":"899M",
					"likes":"432M",
					"trending" : {
						"status" : "áo dài nhiều quá nè !",
						"tags" : ["aodai","vietnam"],
						"music": "bạc phận - jack",
						"video": "./src/video/video9.mp4"
					}
				},
			],
			"listsUser3" : [
				{
					"id":7,
					"avt" :"./src/image/avatar7.jpeg",
					"nickName":"GirlXinh123",
					"realName":"GirlXinhHub",
					"follows":"977M",
					"likes":"384M",
					"trending" : {
						"status" : "Các bạn nghĩ sao về vẻ đẹp này .",
						"tags" : ["girlxinh","Hotgirl"],
						"music": "music - junghoo",
						"video": "./src/video/video4.mp4"
					}
				},
				{
					"id":8 ,
					"avt" :"./src/image/avatar8.jpeg",
					"nickName":"PhongCanhDep",
					"realName":"Du lịch Bụi",
					"follows":"33M",
					"likes":"30M",
					"trending" : {
						"status" : "Nơi an bình , đơn sơ .",
						"tags" : ["dulich","nacthanthienduong","nuitimmongmo","thichngamcanhdep"],
						"music": "violon",
						"video": "./src/video/video5.mp4"
					}
				},
				{
					"id":9 ,
					"avt" :"./src/image/avatar9.jpeg",
					"nickName":"linhnhi.216",
					"realName":"",
					"follows":"664M",
					"likes":"880M",
					"trending" : {
						"status" : "i love you <3",
						"tags" : ["cuoidi"],
						"music": "cưới đi - 2T,ChangC",
						"video": "./src/video/video6.mp4"
					}
				},
			],
			"linksFooter" : [
				[
					{"name":"Giới thiệu","link":"#"},
					{"name":"Bảng tin","link":"#"},
					{"name":"Liên hệ","link":"#"},
					{"name":"Sự nghiệp","link":"#"},
					{"name":"ByteDance","link":"#"},
				],
				[
					{"name":"TikTok for Good","link":"#"},
					{"name":"Quảng cáo","link":"#"},
					{"name":"Developers","link":"#"},
					{"name":"Transparency","link":"#"},
				],
				[
					{"name":"Trợ giúp An toàn","link":"#"},
					{"name":"Điều khoản","link":"#"},
					{"name":"Quyền riêng tư","link":"#"},
					{"name":"Creator Portal","link":"#"},
					{"name":"Hướng dẫn","link":"#"},
					{"name":"Cộng đồng","link":"#"},
				],
			],
			"hotSearch" : [
				{"type":"<i class=\"fas fa-hashtag\"></i>","text":"tiktokfashup"},
				{"type":"<i class=\"fas fa-hashtag\"></i>","text":"tiktokfashupmahonggramngna"},
				{"type":"<i class=\"fas fa-hashtag\"></i>","text":"gametackkeo"},
				{"type":"<i class=\"fas fa-music\"></i>","text":"haconvuongnang"},
				{"type":"<i class=\"fas fa-music\"></i>","text":"buon lam chi em oi"},
				{"type":"<i class=\"fas fa-search\"></i>","text":"tien dilid"},
				{"type":"<i class=\"fas fa-search\"></i>","text":"money"},
			],
			"headerComponent" : {
				logo : {
					logoImg : "https://sf16-scmcdn-sg.ibytedtos.com/goofy/tiktok/web/node/_next/static/images/logo-whole-c555aa707602e714ec956ac96e9db366.svg" ,
					link : '#home' ,
				},
				user :{
					avtImg : 'https://avatars.githubusercontent.com/u/38239103?s=120&v=4',
				},
				keySearch : {
					"keyList":["gái xinh","hot girl","hạ còn vương nắng","tình yêu",
							"dịu dàng là ngày em đến","tình yêu khủng long","buồn tâm trạng",
							"dance","anime","tin tức","giải trí hài hước","Mèo méo meo mèo meo","abcxyz..."
						],
					"default":["gái xinh","hot girl","hạ còn vương nắng","tình yêu"],
				}
			},
	}
// components-header .  
headerComponent = function(logo,search,user){
	let props = tiktokApi.headerComponent ; 
	this.render = () =>{
		return (
				`
					<div class="header-content">
						${logo.render(props.logo)}
						${search.render()}
						${user.render(props.user)}
					</div>
				`
			)
	}
	this.handleInput = () =>{
		search.handleSearchInput(props.keySearch);
	}
}

logo = function(){
	this.render = (props)=>{
		return (
			`
			<div class="header-logo">
				<a href="${props.link}">
					<img src="${props.logoImg}" alt="Logo-Tiktok">
				</a>
			</div>
			`
		)
	}
};

search = function(){
	this.render = () => {
		return (`
				<div class="header-search">
					<input class="header-input" oninput="header.handleInput()" type="text" placeholder="Tìm kiếm tài khoản và video">
					<button><i class="fas fa-search"></i></button>
					${menu()}
				</div>
			`)
	}
	menu = () =>{
		return (`
				<div class="menu-container">
					<ul class="menu-list"></ul>
				</div>
			`)
	}
	this.handleSearchInput = function(keySearch){
		renderKeySearch = function(keyList){
			const menuElement = document.querySelector('.header-search .menu-list');
			menuElement.parentElement.style.display = 'block' ; 
			let contents = keyList.map((key)=>{
				return `
					<li class="menu-item">
						<i class="fas fa-search"></i>
						${key}
					</li>
				`;
			})
			menuElement.innerHTML = contents.join('');
		};
		handleKeySearch = function(){
			const inputElement = document.querySelector(".header-input");
		    let filter, i, content ,contains ;
		    inputElement.oninput = function(){
		    	filter = inputElement.value.toUpperCase();
			   	content = keySearch.keyList;
			   	contains = [];
			    for (i = 0; i < content.length; i++) {
			    	content[i];
			    	if(filter === ''){
			    		continue ; 
			    	}
					else if (content[i].toUpperCase().indexOf(filter) !== -1) {
			        	contains.push(content[i]);
			    	}
			    }
			    if(contains.length === 0 ){
			    	renderKeySearch(keySearch.default)
			    }else{
			    	renderKeySearch(contains)
			    }
		    }
		};
		handleOnblur = function(){
			const menuElement = document.querySelector('.header-search .menu-list');
			document.querySelector('.header-search .header-input').onblur = function(){
				menuElement.parentElement.style.display = 'none' ; 
			}
		};
		handleKeySearch();
		handleOnblur();
	}
}

user = function(){
	this.render = (props)=>{
		return (`
			<div class="header-user">
				<button class="header-upload">
					<i class="fas fa-cloud-upload-alt"></i>
					<span class="title-upload">Tải video lên</span>
				</button>
				<div class="header-message" onclick="document.querySelector('.message-popup').classList.toggle('block')">
					<i class="far fa-comment-alt"></i>
					<div class="message-popup">
						<div class="message-popup-table">
							<h4 class="message-popup-title">Thông báo</h4>
							<div class="message-popup-button">
								<button class="btn active">Tất cả</button>
								<button class="btn">Thích</button>
								<button class="btn">Follower</button>
							</div>
						</div>
						<div class="message-popup-content">
							<div class="message-component">
								<div class="sideBar-img">
									<img src="./src/image/avatar1.jpeg" alt="Avatar">
								</div>
								<div class="message-component-content">
									<span>Bạn đã thích video của <h2>chichi</h2></span>
								</div>
							</div>
							<div class="message-component">
								<div class="sideBar-img">
									<img src="./src/image/avatar2.jpeg" alt="Avatar">
								</div>
								<div class="message-component-content">
									<span>Bạn đã theo dõi <h2>ChinhCute</h2></span>
								</div>
							</div>
							<div class="message-component">
								<div class="sideBar-img">
									<img src="./src/image/avatar3.jpeg" alt="Avatar">
								</div>
								<div class="message-component-content">
									<span>Bạn đã thích video của <h2>huyen2k4</h2></span>
								</div>
							</div>	
						</div>
					</div>
				</div>
				<button class="header-avatar" 
				onmouseover="document.querySelector('.header-user .menu-container').classList.add('block')"
				onmouseout="document.querySelector('.header-user .menu-container').classList.remove('block')">
				<img src="${props.avtImg}" alt="avatar" >
				</button>
				<div class="menu-container">
					<ul class="menu-list">
						${settingItems()}
					</ul>
				</div>
			</div>
		`)
	}
	this.displayMenu = ()=>{
		const menuElement = document.querySelector('.header-user .menu-container') ;
		if(menuElement.className('block')){
			console.log("block")
		}else{
			console.log("no block")
		}
	}
	settingItems = ()=>{
		const items = [
				{"icon":"<i class=\"far fa-user\"></i>","text":"Xem hồ sơ"},
				{"icon":"<i class=\"fab fa-tiktok\"></i>","text":"Nhận xu"},
				{"icon":"<i class=\"fas fa-cog\"></i>","text":"Cài đặt"},
				{"icon":"<i class=\"far fa-question-circle\"></i>","text":"Phản hồi và trợ giúp"},
				{"icon":"<i class=\"fas fa-sign-out-alt\"></i>","text":"Đăng xuất"}
			]
		let lists = items.map(item =>{
			return (
				`
				<li class="menu-item">
					${item.icon}
					${item.text}
				</li>
				`);
		})
		return lists.join('') ; 
	}
}

Main = function(){
	this.render = ()=>{
		return (`
			<div class="header-container"></div>
			<div class="main-container">
				<div class="main-sideBar"></div>
				<div class="main-trending"></div>
			</div>
			`)
	}
}

mainSideBar = function(){
	const listUser1 = tiktokApi.listsUser1 ; 
	const listUser2 = tiktokApi.listsUser2 ; 
	const listsKeySearch = tiktokApi.hotSearch ; 
	const links = tiktokApi.linksFooter ; 
	this.render = ()=>{
		return (`
				<div class="main-sideBar-body">
					<div class="sideBar-home">
						<ul class="sideBar-menu">
							<li class="sideBar-item">
								<i class="fas fa-home"></i>
								Dành cho bạn
							</li>
							<li class="sideBar-item">
								<i class="fas fa-user-friends"></i>
								Đang Follow
							</li>
							<li class="sideBar-item">
								<i class="fas fa-video"></i>
								LIVE
							</li>
						</ul>
					</div>
					<div class="sideBar-component">
			 			<h2 class="component-heading">Tài khoản được đề xuất</h2>
						${listComponents(listUser1)}
						<div class="sideBar-extension">xem thêm</div>
					</div>
					<div class="sideBar-component">
			 			<h2 class="component-heading">Các tài khoản đang follow</h2>
						${listComponents(listUser2)}
						<div class="sideBar-extension">xem tất cả</div>
					</div>
					${listsKey(listsKeySearch)}
					<div class="sideBar-footer">
						${listLinks(links)}
						<div class="sideBar-footer-wrapper more" title="Nguyên tắc thực thi pháp luật của TikTok.">Thêm</div>
						<div class="sideBar-footer-wrapper copyright"><i class="far fa-copyright"></i> 2021 TikTok</div>
					</div>
				</div>
			`)
	}
	listComponents = (lists) =>{
		const newLists = lists.map((item) =>{
			return (`
						<li class="sideBar-item">
							<div class="sideBar-img">
								<img src="${item.avt}" alt="Avatar">
							</div>
							<a href="#">
								<span class="nick-name">${item.nickName}</span>
								<span class="real-name">${item.realName}</span>
							</a>
							<div class="sideBar-item-popup">
								<div class="sideBar-popup-img">
									<div class="sideBar-img">
										<img src="${item.avt}" alt="Avatar">
									</div>
									<button>Follow</button>
								</div>
								<div class="sideBar-popup-name">
									<span class="nick-name">${item.nickName}</span>
									<span class="real-name">${item.realName}</span>
								</div>
								<div class="sideBar-popup-like">
									<div class="like">
										<h4>${item.follows}</h4> Follower
									</div>
									<div class="like">
										<h4>${item.likes}</h4> Thích
									</div>
								</div>
							</div>
						</li>
				`)
		})
		return (`<ul class="component-menu">${newLists.join('')}</ul>`)
	}
	listsKey = (listsKey)=>{
		const newLists = listsKey.map((key) =>{
			return (
				`<button class="sideBar-button-item">
					${key.type}
					${key.text}
				</button>`)
		})
		return (`
				<div class="sideBar-component">
		 			<h2 class="component-heading">Khám phá</h2>
					<div class="sideBar-button-container">${newLists.join('')}</div>
				</div>
			`)
	}
	listLinks = (links) =>{
		const newLists = links.map(link =>{
			let linkWrapper = link.map(item =>{
				return (`<a href="${item.link}">${item.name}</a>`) ; 
			})
			return (`<div class="sideBar-footer-wrapper">${linkWrapper.join('')}</div>`);
		})
		return newLists.join('') ; 
	}
}

mainTrending = function(){
	this.render = () =>{
		return (`
			${componentTrending(users1)}
			${componentTrending(users2)}
			${componentTrending(users3)}
			`)
	}
	const users1 = tiktokApi.listsUser1 ; 
	const users2 = tiktokApi.listsUser2 ; 
	const users3 = tiktokApi.listsUser3 ; 
	componentTrending = function(components){
		const html = components.map((component)=>{
			return (`
				<div class="compoent-trending-wrapper">
					<div class="component-trending-body">
						<div class="component-trending-avatar">
							<div class="sideBar-img">
								<img src="${component.avt}" alt="Avatar">
							</div>
							<button onclick="this.innerHTML = 'Đã Follow',this.style.color = '#333',
							this.style.borderColor = '#333' " >Follow</button>
						</div>
						<div class="component-trending-content">
							<div class="component-trending-name">
								<span class="nick-name">${component.nickName}</span>
								<span class="real-name">${component.realName}</span>
							</div>
							<div class="component-trending-status"><span class="text">${component.trending.status}</span>${renderTags(component.trending.tags)}</div>
							<div class="component-trending-music"><i class="fas fa-music"></i> ${component.trending.music}</div>
							<div class="trending-video-container">
								<div class="item-video">
									<div class="image-card">
										<div class="video-card">
											<video  
											volume="0.8"
											ratioheight="calc(450px + (100vw - 480px) / 288 * 70)"
											ratiowidth="calc(0.56 * (450px + (100vw - 480px) / 288 * 70))"
											muted="muted" allow="autoplay" autoplay playsinline loop name="media">
												<source src="${component.trending.video}" type="video/mp4">
											</video>
										</div>
									</div>
								</div>
								<div class="trending-button-action">
									<button class="trending-button-like" onclick="trending.handleLikeTrending(this)"><i class="fas fa-heart"></i></button>
									<button class="trending-button-share"><i class="fas fa-share"></i></button>
									<button class="trending-button-comment"><i class="far fa-comment-dots"></i></button>
								</div>
								<div class="trending-button-control">
									<button class="trending-button-pause" onclick="trending.handlePlay(this)"><i class="far fa-pause-circle"></i></button>
									<button class="trending-button-muted" id="muted" onclick="trending.handleMuted(this)"><i class="fas fa-volume-mute"></i></button>
								</div>
							</div>
						</div>
					</div>
				</div>
			`)
		})
		return html.join('')
	}
	renderTags = function(tags){
		const result = tags.map(tag =>{
			return `<span class="tag">#${tag}</span>`
		})
		return result.join('') ; 
	}
	this.handleLikeTrending = (e) =>{
		e.parentElement.classList.toggle("active") ;
	}
	this.handlePlay = (e) =>{
		const videoEl = e.parentElement.parentElement.querySelector('video') ; 
		if(e.className == 'trending-button-pause'){
			videoEl.autoplay = false ; 
			e.classList.remove('trending-button-pause'); 
			e.classList.add('trending-button-play') ;
			e.innerHTML = `<i class="far fa-play-circle"></i>`;
			videoEl.pause(); 
		}else{
			videoEl.autoplay = true ;
			e.classList.remove('trending-button-play') ; 
			e.classList.add('trending-button-pause');
			e.innerHTML = `<i class="far fa-pause-circle"></i>`;
			videoEl.play();
		} 
	}
	this.handleAutoplay = () =>{
		window.addEventListener('load', videoScroll);
		window.addEventListener('scroll', videoScroll);
		function videoScroll() {
		  if ( document.querySelectorAll('video[autoplay]').length > 0) {
		    let windowHeight = window.innerHeight,
		        videoEl = document.querySelectorAll('video[autoplay]');

		    for (let i = 0; i < videoEl.length; i++) {

		      let thisVideoEl = videoEl[i],
		          videoHeight = thisVideoEl.clientHeight,
		          videoClientRect = thisVideoEl.getBoundingClientRect().top;

		      if ( videoClientRect <= ( (windowHeight) - (videoHeight*.5) ) && videoClientRect >= ( 0 - ( videoHeight*.5 ) ) ) {
		        thisVideoEl.play();
		      }else{
		        thisVideoEl.pause();
		      }
		    }
		  }
		}
	}
	this.handleMuted = (e)=>{
		const videoEl = document.querySelectorAll('video') ;
		const mutedEl = document.querySelectorAll('#muted') ; 
		if(e.className == 'trending-button-muted'){
			for(let i = 0 ; i < videoEl.length ; i++){
				videoEl[i].muted = false ; 
				mutedEl[i].classList.remove('trending-button-muted'); 
				mutedEl[i].classList.add('trending-button-notMuted') ;
				mutedEl[i].innerHTML = `<i class="fas fa-volume-up"></i>`;
			}
		}else{
			for(let i = 0 ; i < videoEl.length ; i++){
				videoEl[i].muted = true ; 
				mutedEl[i].classList.remove('trending-button-notMuted');
				mutedEl[i].classList.add('trending-button-muted');
				mutedEl[i].innerHTML = `<i class="fas fa-volume-mute"></i>`;
			}
		} 
	}
}

const body = new Main() ; 
const header = new headerComponent(new logo() , new search() , new user()) ;
const sideBar = new mainSideBar() ;
const trending = new mainTrending() ; 


document.querySelector('#root').innerHTML = body.render() ; 

document.querySelector('#root .header-container').innerHTML = header.render() ;

document.querySelector('.main-sideBar').innerHTML = sideBar.render() ; 

document.querySelector(".main-container .main-trending").innerHTML = trending.render() ; 

trending.handleAutoplay() ; 
